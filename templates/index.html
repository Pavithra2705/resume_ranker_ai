<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ResumeRank AI v2 â€” Intelligent ATS</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --ink: #0f0e0c;
  --paper: #f5f0e8;
  --cream: #ede8dc;
  --gold: #c9a84c;
  --gold-l: #e8c97a;
  --red: #b5321a;
  --green: #2a6b3f;
  --blue: #1a3a5c;
  --purple: #5b21b6;
  --orange: #c2410c;
  --muted: #7a7060;
  --border: #d4cec0;
  --white: #fff;
  --shadow: 0 4px 24px rgba(0,0,0,0.07);
}
* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--paper);
  color: var(--ink);
  background-image:
    repeating-linear-gradient(0deg, transparent, transparent 27px, rgba(0,0,0,0.025) 28px);
}

/* â”€â”€ HEADER â”€â”€ */
header {
  border-bottom: 2px solid var(--ink);
  padding: 0 48px;
  background: var(--paper);
  position: sticky; top:0; z-index:200;
  display: flex; align-items: center; justify-content: space-between;
}
.logo {
  font-family: 'Playfair Display', serif;
  font-size: 1.4rem; font-weight:900;
  padding: 16px 0; letter-spacing:-0.02em;
}
.logo span { color: var(--gold); }
.logo sub {
  font-size:.6rem; font-family:'DM Mono',monospace;
  background:var(--ink); color:var(--paper);
  padding:2px 6px; border-radius:2px; margin-left:6px;
  vertical-align:middle; letter-spacing:.05em;
}
.header-pills { display:flex; gap:8px; }
.pill {
  font-family:'DM Mono',monospace; font-size:.62rem;
  letter-spacing:.12em; text-transform:uppercase;
  border:1px solid var(--border); padding:4px 10px;
  border-radius:2px; color:var(--muted);
}

/* â”€â”€ LAYOUT â”€â”€ */
.page { max-width:1160px; margin:0 auto; padding:0 48px 80px; }

/* â”€â”€ HERO â”€â”€ */
.hero {
  display:grid; grid-template-columns:1fr 1fr;
  gap:56px; align-items:center;
  padding: 56px 0 40px;
}
.hero-title {
  font-family:'Playfair Display',serif;
  font-size: clamp(2.6rem,4.5vw,4.2rem);
  font-weight:900; line-height:1.05; letter-spacing:-0.03em;
}
.hero-title em { font-style:italic; color:var(--gold); }
.hero-desc { margin-top:18px; font-size:.95rem; color:var(--muted); line-height:1.7; }
.hero-stats { display:flex; gap:28px; margin-top:32px; }
.stat { border-left:3px solid var(--gold); padding-left:14px; }
.stat-num { font-family:'Playfair Display',serif; font-size:1.8rem; font-weight:700; line-height:1; }
.stat-lbl { font-family:'DM Mono',monospace; font-size:.62rem; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); margin-top:3px; }

/* IMPROVEMENT BADGES */
.improvements {
  background:var(--ink); color:var(--paper);
  padding:28px 32px; border-radius:4px; overflow:hidden; position:relative;
}
.improvements::before {
  content:''; position:absolute; top:-50px; right:-50px;
  width:160px; height:160px;
  border:35px solid rgba(201,168,76,.12); border-radius:50%;
}
.imp-title {
  font-family:'DM Mono',monospace; font-size:.62rem;
  letter-spacing:.18em; text-transform:uppercase; color:var(--gold);
  margin-bottom:16px;
}
.imp-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
.imp-item {
  font-size:.78rem; color:rgba(245,240,232,.8); line-height:1.4;
  display:flex; gap:8px; align-items:flex-start;
}
.imp-icon { color:var(--gold); flex-shrink:0; }

/* â”€â”€ FORM CARD â”€â”€ */
.form-card {
  background:var(--white);
  border:1px solid var(--border); border-radius:4px;
  box-shadow:var(--shadow); overflow:hidden;
}
.form-card-header {
  background:var(--ink); color:var(--paper);
  padding:16px 28px;
  display:flex; align-items:center; justify-content:space-between;
}
.form-card-title { font-family:'DM Mono',monospace; font-size:.68rem; letter-spacing:.14em; text-transform:uppercase; }
.form-body { padding:28px; display:grid; grid-template-columns:1fr 1fr; gap:24px; }

label, .field-label {
  display:block; font-family:'DM Mono',monospace;
  font-size:.62rem; letter-spacing:.12em; text-transform:uppercase;
  color:var(--muted); margin-bottom:8px;
}

textarea {
  width:100%; height:210px;
  border:1px solid var(--border); border-radius:3px;
  padding:14px; font-family:'DM Sans',sans-serif; font-size:.88rem;
  line-height:1.65; resize:vertical; background:var(--paper);
  color:var(--ink); transition:border-color .2s;
}
textarea:focus { outline:none; border-color:var(--ink); }

/* PROFILE SELECTOR */
.profile-row { padding:0 28px 6px; }
.profile-grid { display:flex; gap:8px; flex-wrap:wrap; }
.profile-btn {
  padding:8px 16px; border:1px solid var(--border); border-radius:3px;
  background:var(--paper); cursor:pointer; font-family:'DM Mono',monospace;
  font-size:.68rem; letter-spacing:.06em; color:var(--muted);
  transition:all .2s; position:relative;
}
.profile-btn:hover { border-color:var(--gold); color:var(--ink); }
.profile-btn.active {
  background:var(--ink); color:var(--paper); border-color:var(--ink);
}
.profile-btn .profile-desc {
  position:absolute; bottom:calc(100% + 8px); left:50%; transform:translateX(-50%);
  white-space:nowrap; background:var(--ink); color:var(--paper);
  padding:6px 12px; border-radius:3px; font-size:.62rem; pointer-events:none;
  opacity:0; transition:opacity .2s; z-index:10;
}
.profile-btn:hover .profile-desc { opacity:1; }

/* DROPZONE */
.dropzone {
  border:2px dashed var(--border); border-radius:3px; height:210px;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  cursor:pointer; transition:all .2s; background:var(--paper); position:relative;
}
.dropzone:hover, .dropzone.drag-over { border-color:var(--gold); background:#fdf9f0; }
.dropzone input {
  position:absolute; inset:0; opacity:0; cursor:pointer;
  width:100%; height:100%; z-index:0; pointer-events:none;
}
.dz-icon { font-size:1.8rem; margin-bottom:10px; color:var(--gold); }
.dz-text { font-family:'DM Mono',monospace; font-size:.72rem; text-align:center; color:var(--muted); line-height:1.6; }
.dz-text strong { color:var(--ink); display:block; margin-bottom:3px; }

.file-list { margin-top:10px; }
.file-chip {
  display:inline-flex; align-items:center; gap:5px;
  background:var(--cream); border:1px solid var(--border); border-radius:2px;
  padding:3px 9px; font-family:'DM Mono',monospace; font-size:.67rem;
  margin:2px; color:var(--ink);
}
.file-chip button { background:none; border:none; cursor:pointer; color:var(--red); font-size:.9rem; }

/* SUBMIT */
.form-footer { padding:0 28px 28px; display:flex; gap:12px; align-items:center; }
.btn-rank {
  flex:1; padding:15px; background:var(--ink); color:var(--paper);
  border:none; border-radius:3px; cursor:pointer;
  font-family:'Playfair Display',serif; font-size:1.05rem; font-weight:700;
  display:flex; align-items:center; justify-content:center; gap:10px;
  transition:all .25s; position:relative; overflow:hidden;
}
.btn-rank::before {
  content:''; position:absolute; left:0; top:0;
  width:0; height:100%; background:var(--gold); transition:width .35s; z-index:0;
}
.btn-rank:hover::before { width:100%; }
.btn-rank:hover { color:var(--ink); }
.btn-rank span { position:relative; z-index:1; }
.btn-rank:disabled { opacity:.5; cursor:not-allowed; }

/* â”€â”€ LOADING â”€â”€ */
.loading { display:none; text-align:center; padding:56px 40px; border:1px solid var(--border); border-radius:4px; background:var(--white); margin-top:28px; }
.loading.active { display:block; }
.loader {
  width:44px; height:44px; margin:0 auto 18px;
  border:3px solid var(--cream); border-top-color:var(--gold);
  border-radius:50%; animation:spin .8s linear infinite;
}
@keyframes spin { to { transform:rotate(360deg); } }
.loading-text { font-family:'DM Mono',monospace; font-size:.72rem; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); }
.loading-sub { font-size:.75rem; color:var(--muted); margin-top:8px; }

/* â”€â”€ RESULTS â”€â”€ */
.results-section { display:none; margin-top:28px; }
.results-section.active { display:block; }

.results-bar {
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:20px; flex-wrap:wrap; gap:12px;
}
.results-title { font-family:'Playfair Display',serif; font-size:1.5rem; font-weight:700; }
.results-meta { font-family:'DM Mono',monospace; font-size:.68rem; color:var(--muted); margin-top:3px; }

.action-row { display:flex; gap:8px; }
.btn-outline {
  display:flex; align-items:center; gap:7px;
  padding:9px 18px; border:1px solid var(--ink); border-radius:3px;
  background:transparent; cursor:pointer; font-family:'DM Mono',monospace;
  font-size:.67rem; letter-spacing:.08em; text-transform:uppercase;
  color:var(--ink); text-decoration:none; transition:all .2s;
}
.btn-outline:hover { background:var(--ink); color:var(--paper); }

/* â”€â”€ SUMMARY CARDS â”€â”€ */
.summary-row { display:grid; grid-template-columns:repeat(4,1fr); gap:14px; margin-bottom:24px; }
.sum-card {
  background:var(--white); border:1px solid var(--border); border-radius:4px;
  padding:18px 20px;
}
.sum-num { font-family:'Playfair Display',serif; font-size:2rem; font-weight:900; line-height:1; }
.sum-lbl { font-family:'DM Mono',monospace; font-size:.62rem; letter-spacing:.08em; text-transform:uppercase; color:var(--muted); margin-top:4px; }

/* â”€â”€ CANDIDATE CARD â”€â”€ */
.candidate-card {
  background:var(--white); border:1px solid var(--border); border-radius:4px;
  margin-bottom:14px; overflow:hidden; transition:box-shadow .2s;
}
.candidate-card:hover { box-shadow:0 8px 32px rgba(0,0,0,.09); }
.candidate-card.rank-1 { border:2px solid var(--gold); }
.candidate-card.rank-2 { border-left:4px solid #9ca3af; }
.candidate-card.rank-3 { border-left:4px solid #b45309; }

.card-top {
  display:grid; grid-template-columns:72px 1fr auto;
  align-items:center; gap:18px; padding:18px 22px; cursor:pointer;
}
.rank-badge { font-family:'Playfair Display',serif; font-size:2rem; font-weight:900; text-align:center; color:var(--muted); }
.rank-1 .rank-badge { color:var(--gold); }
.rank-2 .rank-badge { color:#6b7280; }
.rank-3 .rank-badge { color:#92400e; }

.cand-name { font-size:.98rem; font-weight:600; }
.cand-meta { font-family:'DM Mono',monospace; font-size:.66rem; color:var(--muted); margin-top:3px; }

.score-right { display:flex; align-items:center; gap:14px; }
.score-num { font-family:'Playfair Display',serif; font-size:2.1rem; font-weight:900; line-height:1; }
.rank-1 .score-num { color:var(--gold); }

.grade-chip {
  display:inline-block; padding:2px 9px; border-radius:2px;
  font-family:'DM Mono',monospace; font-size:.62rem; letter-spacing:.08em;
  margin-top:4px;
}
.gA\+ { background:#d1fae5; color:#065f46; }
.gA  { background:#d1fae5; color:#065f46; }
.gB  { background:#dbeafe; color:#1e40af; }
.gC  { background:#fef9c3; color:#854d0e; }
.gD  { background:#fee2e2; color:#991b1b; }
.gF  { background:#f3f4f6; color:var(--muted); }

.expand-btn { font-size:1.1rem; color:var(--muted); transition:transform .3s; }
.card-top.open .expand-btn { transform:rotate(180deg); }

/* â”€â”€ CARD DETAILS â”€â”€ */
.card-details { display:none; border-top:1px solid var(--cream); padding:22px; }
.card-details.open { display:block; }

/* Score breakdown bars */
.breakdown-title {
  font-family:'DM Mono',monospace; font-size:.62rem; letter-spacing:.12em;
  text-transform:uppercase; color:var(--muted); margin-bottom:14px;
}
.score-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:12px; margin-bottom:20px; }
.score-bar-item { }
.score-bar-item label { margin-bottom:6px; }
.bar-track { height:8px; background:var(--cream); border-radius:4px; overflow:hidden; }
.bar-fill { height:100%; border-radius:4px; transition:width .9s ease; }
.bar-tfidf    { background:linear-gradient(90deg,#6366f1,#8b5cf6); }
.bar-keyword  { background:linear-gradient(90deg,#0891b2,#06b6d4); }
.bar-skill    { background:linear-gradient(90deg,#c9a84c,#e8c97a); }
.bar-exp      { background:linear-gradient(90deg,#059669,#34d399); }
.bar-edu      { background:linear-gradient(90deg,#dc2626,#f87171); }
.bar-val { font-family:'DM Mono',monospace; font-size:.68rem; color:var(--muted); margin-top:4px; }

/* Skill sections */
.skills-row { display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px; margin-top:4px; }
.skill-group-title {
  font-family:'DM Mono',monospace; font-size:.6rem; letter-spacing:.1em;
  text-transform:uppercase; margin-bottom:8px;
}
.skill-tag {
  display:inline-block; padding:3px 9px;
  border-radius:2px; font-family:'DM Mono',monospace; font-size:.63rem;
  margin:2px;
}
.tag-match   { background:#d1fae5; border:1px solid #a7f3d0; color:#065f46; }
.tag-found   { background:var(--cream); border:1px solid var(--border); color:var(--ink); }
.tag-missing { background:#fee2e2; border:1px solid #fecaca; color:#991b1b; }

/* Radar chart */
.detail-bottom { display:grid; grid-template-columns:1fr 260px; gap:20px; margin-top:20px; }
.preview-box {
  background:var(--paper); border:1px solid var(--border); border-radius:3px;
  padding:12px; font-size:.78rem; line-height:1.65; color:var(--muted);
  font-family:'DM Mono',monospace; max-height:140px; overflow-y:auto;
}
.radar-wrap { display:flex; flex-direction:column; align-items:center; }
.radar-title { font-family:'DM Mono',monospace; font-size:.6rem; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); margin-bottom:8px; }

/* â”€â”€ Required skill badges â”€â”€ */
.tag-required { background:#fef3c7; border:1px solid #fcd34d; color:#92400e; }
.tag-required-hit { background:#d1fae5; border:2px solid #059669; color:#065f46; font-weight:600; }
.tag-required-miss { background:#fee2e2; border:2px solid #dc2626; color:#991b1b; font-weight:600; }
.tag-preferred { background:#ede9fe; border:1px solid #c4b5fd; color:#5b21b6; }

/* â”€â”€ ATS compliance bar â”€â”€ */
.ats-bar-wrap { margin:16px 0 4px; }
.ats-bar-label {
  font-family:'DM Mono',monospace; font-size:.6rem; letter-spacing:.1em;
  text-transform:uppercase; color:var(--muted); margin-bottom:6px;
  display:flex; justify-content:space-between;
}
.ats-bar-label span { font-size:.72rem; font-weight:600; }
.ats-track { height:12px; background:var(--cream); border-radius:6px; overflow:hidden; }
.ats-fill {
  height:100%; border-radius:6px;
  transition:width 1.1s ease;
}
.ats-fill.full   { background:linear-gradient(90deg,#059669,#34d399); }
.ats-fill.high   { background:linear-gradient(90deg,#2563eb,#60a5fa); }
.ats-fill.mid    { background:linear-gradient(90deg,#d97706,#fbbf24); }
.ats-fill.low    { background:linear-gradient(90deg,#dc2626,#f87171); }

/* â”€â”€ Explainability section â”€â”€ */
.explain-section {
  margin-top:18px; padding:16px 18px;
  background:var(--paper); border:1px solid var(--border); border-radius:3px;
}
.explain-title {
  font-family:'DM Mono',monospace; font-size:.6rem; letter-spacing:.12em;
  text-transform:uppercase; color:var(--muted); margin-bottom:12px;
  display:flex; align-items:center; gap:8px;
}
.explain-title::after {
  content:''; flex:1; height:1px; background:var(--border);
}
.explain-line {
  font-size:.82rem; line-height:1.6; padding:5px 0;
  border-bottom:1px solid var(--cream); color:var(--ink);
  display:flex; gap:8px; align-items:flex-start;
}
.explain-line:last-child { border-bottom:none; }
.explain-icon { flex-shrink:0; width:18px; text-align:center; }
.explain-text { flex:1; }

/* â”€â”€ WARNINGS â”€â”€ */
.warning-bar {
  background:#fef3c7; border:1px solid #fcd34d; border-radius:3px;
  padding:10px 16px; margin-bottom:16px;
  font-family:'DM Mono',monospace; font-size:.72rem; color:#92400e;
}

/* â”€â”€ JD QUALITY SCORER â”€â”€ */
.jd-score-panel {
  background:var(--white); border:1px solid var(--border); border-radius:4px;
  margin-top:14px; overflow:hidden; display:none;
}
.jd-score-panel.active { display:block; }
.jd-panel-header {
  display:flex; align-items:center; justify-content:space-between;
  padding:14px 22px; background:var(--ink); color:var(--paper);
}
.jd-panel-title { font-family:'DM Mono',monospace; font-size:.68rem; letter-spacing:.14em; text-transform:uppercase; }
.jd-overall-badge {
  font-family:'Playfair Display',serif; font-size:1.4rem; font-weight:900;
  display:flex; align-items:center; gap:10px;
}
.jd-grade-chip {
  font-family:'DM Mono',monospace; font-size:.65rem; padding:3px 10px;
  border-radius:2px; letter-spacing:.06em;
}
.jd-body { padding:20px 22px; }
.jd-dim-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:18px; }
.jd-dim-item { text-align:center; }
.jd-dim-val {
  font-family:'Playfair Display',serif; font-size:1.5rem; font-weight:900;
  line-height:1;
}
.jd-dim-lbl { font-family:'DM Mono',monospace; font-size:.57rem; letter-spacing:.08em; text-transform:uppercase; color:var(--muted); margin-top:4px; }
.jd-dim-bar { height:5px; border-radius:3px; margin-top:6px; }
.jd-verdict { font-size:.88rem; font-style:italic; color:var(--muted); margin-bottom:14px; padding-bottom:14px; border-bottom:1px solid var(--cream); }
.jd-bias-list { margin-bottom:14px; }
.bias-flag {
  display:flex; gap:10px; padding:8px 12px; border-radius:3px;
  margin-bottom:6px; font-size:.8rem;
}
.bias-high   { background:#fee2e2; border-left:3px solid #dc2626; }
.bias-medium { background:#fef3c7; border-left:3px solid #f59e0b; }
.bias-low    { background:#f0fdf4; border-left:3px solid #86efac; }
.bias-flag strong { display:block; margin-bottom:2px; }
.jd-suggestions { }
.jd-suggest-item {
  font-size:.8rem; padding:6px 0; border-bottom:1px solid var(--cream);
  color:var(--ink); line-height:1.5;
}
.jd-suggest-item:last-child { border-bottom:none; }

/* â”€â”€ RED FLAG DETECTOR â”€â”€ */
.redflag-section {
  margin-top:16px; padding:14px 18px;
  border-radius:3px; border:1px solid var(--border);
}
.redflag-header {
  display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;
}
.risk-badge {
  font-family:'DM Mono',monospace; font-size:.65rem; padding:4px 12px;
  border-radius:2px; letter-spacing:.06em; font-weight:600;
}
.risk-Low    { background:#d1fae5; color:#065f46; }
.risk-Medium { background:#fef3c7; color:#92400e; }
.risk-High   { background:#fee2e2; color:#991b1b; }
.flag-item {
  display:flex; gap:10px; align-items:flex-start; padding:6px 0;
  border-bottom:1px solid var(--cream); font-size:.78rem;
}
.flag-item:last-child { border-bottom:none; }
.flag-icon { flex-shrink:0; width:20px; text-align:center; }
.flag-body strong { display:block; color:var(--ink); margin-bottom:1px; }
.flag-body span { color:var(--muted); font-size:.73rem; }
.green-flag-list { display:flex; flex-wrap:wrap; gap:6px; margin-top:10px; }
.green-tag {
  background:#d1fae5; border:1px solid #a7f3d0; color:#065f46;
  font-family:'DM Mono',monospace; font-size:.62rem; padding:3px 8px; border-radius:2px;
}

/* â”€â”€ COMPARISON MODE â”€â”€ */
.compare-section {
  background:var(--white); border:1px solid var(--border); border-radius:4px;
  margin-top:20px; overflow:hidden; display:none;
}
.compare-section.active { display:block; }
.compare-header {
  background:var(--ink); color:var(--paper); padding:14px 22px;
  display:flex; align-items:center; justify-content:space-between;
}
.compare-title { font-family:'DM Mono',monospace; font-size:.68rem; letter-spacing:.14em; text-transform:uppercase; }
.compare-close { background:none; border:none; color:var(--paper); cursor:pointer; font-size:1.1rem; }
.compare-body { padding:22px; }
.compare-grid { display:grid; grid-template-columns:1fr 80px 1fr; gap:0; margin-bottom:20px; }
.compare-col { }
.compare-col-header {
  text-align:center; padding:12px 16px; background:var(--cream); border-radius:3px;
  margin-bottom:14px;
}
.compare-col-name { font-size:.9rem; font-weight:600; }
.compare-col-score { font-family:'Playfair Display',serif; font-size:1.6rem; font-weight:900; color:var(--gold); }
.compare-col-grade { font-family:'DM Mono',monospace; font-size:.62rem; color:var(--muted); }
.compare-vs { display:flex; align-items:center; justify-content:center; }
.vs-label { font-family:'Playfair Display',serif; font-size:1.2rem; font-weight:700; color:var(--muted); }
.signal-row {
  display:grid; grid-template-columns:1fr 80px 1fr; align-items:center;
  margin-bottom:8px; gap:0;
}
.signal-bar-left { display:flex; justify-content:flex-end; align-items:center; gap:8px; }
.signal-bar-right { display:flex; justify-content:flex-start; align-items:center; gap:8px; }
.signal-val { font-family:'DM Mono',monospace; font-size:.72rem; font-weight:600; }
.signal-name { text-align:center; font-family:'DM Mono',monospace; font-size:.6rem; color:var(--muted); letter-spacing:.06em; }
.sig-bar { height:10px; border-radius:3px; min-width:4px; transition:width .8s ease; }
.sig-bar-a { background:linear-gradient(90deg,var(--gold),#e8c97a); }
.sig-bar-b { background:linear-gradient(90deg,#6366f1,#8b5cf6); }
.winner-a { color:var(--gold); }
.winner-b { color:#6366f1; }
.compare-skills { display:grid; grid-template-columns:1fr 1fr 1fr; gap:14px; margin-top:18px; border-top:1px solid var(--cream); padding-top:18px; }
.compare-skill-title { font-family:'DM Mono',monospace; font-size:.6rem; letter-spacing:.1em; text-transform:uppercase; margin-bottom:8px; }
.compare-recommendation {
  margin-top:16px; padding:14px 18px; border-radius:3px;
  background:var(--ink); color:var(--paper);
  font-size:.88rem; line-height:1.6;
}
.compare-select-row { display:flex; gap:12px; align-items:center; margin-bottom:18px; flex-wrap:wrap; }
.compare-select { padding:8px 12px; border:1px solid var(--border); border-radius:3px; font-family:'DM Mono',monospace; font-size:.68rem; background:var(--paper); color:var(--ink); }
.btn-compare { padding:9px 20px; background:var(--gold); color:var(--ink); border:none; border-radius:3px; cursor:pointer; font-family:'DM Mono',monospace; font-size:.68rem; font-weight:600; letter-spacing:.06em; }
.btn-compare:hover { background:var(--gold-l); }

/* â”€â”€ RESPONSIVE â”€â”€ */
@media(max-width:900px) {
  .hero { grid-template-columns:1fr; gap:28px; padding:32px 0 24px; }
  .form-body { grid-template-columns:1fr; }
  .score-grid { grid-template-columns:repeat(3,1fr); }
  .skills-row { grid-template-columns:1fr 1fr; }
  .summary-row { grid-template-columns:repeat(2,1fr); }
  .detail-bottom { grid-template-columns:1fr; }
  header, .page { padding-left:20px; padding-right:20px; }
}
@media(max-width:580px) {
  .score-grid { grid-template-columns:1fr 1fr; }
  .card-top { grid-template-columns:52px 1fr; }
  .score-right { display:none; }
}
</style>
</head>
<body>

<header>
  <div class="logo">Resume<span>Rank</span> AI<sub>v2</sub></div>
  <div class="header-pills">
    <span class="pill">JD Quality Scorer</span>
    <span class="pill">Red Flag Detector</span>
    <span class="pill">Compare Mode</span>
  </div>
</header>

<div class="page">

  <!-- HERO -->
  <div class="hero" style="grid-template-columns:1fr;">
    <div>
      <h1 class="hero-title">Rank Smarter.<br>Hire <em>Faster.</em></h1>
      <p class="hero-desc">Industry-grade ATS scoring: global TF-IDF, 3-tier skill taxonomy, section-aware detection, stuffing penalties, and configurable weight profiles.</p>
      <div class="hero-stats">
        <div class="stat"><div class="stat-num">8</div><div class="stat-lbl">Score Signals</div></div>
        <div class="stat"><div class="stat-num">80+</div><div class="stat-lbl">Skills Detected</div></div>
        <div class="stat"><div class="stat-num">3</div><div class="stat-lbl">New Features</div></div>
      </div>
    </div>
  </div>

  <!-- FORM -->
  <div class="form-card">
    <div class="form-card-header">
      <span class="form-card-title">Configure Ranking Job</span>
      <span style="font-family:'DM Mono',monospace;font-size:.62rem;color:rgba(245,240,232,.5);">PDF Â· TXT Â· DOCX</span>
    </div>
    <form id="rankForm">
      <div class="form-body">
        <div>
          <label for="jd">Job Description</label>
          <textarea id="jd" name="job_description" placeholder="Paste the full job description here â€” skills, requirements, responsibilities, qualifications..."></textarea>
        </div>
        <div>
          <label>Resume Files</label>
          <div class="dropzone" id="dropzone">
            <input type="file" id="fileInput" name="resumes" multiple accept=".pdf,.txt,.md,.docx">
            <div class="dz-icon">ğŸ“„</div>
            <div class="dz-text">
              <strong>Drop resumes here or click to browse</strong>
              PDF, TXT, DOCX â€” up to 16 MB total
            </div>
          </div>
          <div class="file-list" id="fileList"></div>
        </div>
      </div>

      <!-- Profile selector -->
      <div class="profile-row">
        <div class="field-label">Scoring Profile</div>
        <div class="profile-grid" id="profileGrid">
          <button type="button" class="profile-btn active" data-profile="balanced">
            Balanced
            <span class="profile-desc">General purpose â€” equal emphasis</span>
          </button>
          <button type="button" class="profile-btn" data-profile="senior">
            Senior / Lead
            <span class="profile-desc">Prioritizes experience</span>
          </button>
          <button type="button" class="profile-btn" data-profile="fresher">
            Fresh Graduate
            <span class="profile-desc">Prioritizes education & projects</span>
          </button>
          <button type="button" class="profile-btn" data-profile="technical">
            Technical
            <span class="profile-desc">Max weight on tech skills</span>
          </button>
          <button type="button" class="profile-btn" data-profile="management">
            Management
            <span class="profile-desc">Keywords + education focus</span>
          </button>
        </div>
      </div>

      <div class="form-footer">
        <button type="button" class="btn-outline" id="analyzeJdBtn" onclick="analyzeJD()" style="white-space:nowrap;">
          ğŸ” Score JD Quality
        </button>
        <button type="submit" class="btn-rank" id="rankBtn">
          <span>âš¡ Rank All Candidates</span>
        </button>
      </div>
    </form>
  </div>

  <!-- JD QUALITY SCORER PANEL -->
  <div class="jd-score-panel" id="jdScorePanel"></div>

  <!-- LOADING -->
  <div class="loading" id="loading">
    <div class="loader"></div>
    <div class="loading-text">Processing resumesâ€¦</div>
    <div class="loading-sub" id="loadingStep">Fitting TF-IDF on all documents</div>
  </div>

  <!-- RESULTS -->
  <div class="results-section" id="resultsSection">
    <div class="results-bar">
      <div>
        <h2 class="results-title">Candidate Rankings</h2>
        <div class="results-meta" id="resultsMeta"></div>
      </div>
      <div class="action-row">
        <button class="btn-outline" id="compareBtn" onclick="openCompare()" style="display:none">âš–ï¸ Compare Candidates</button>
        <a id="downloadBtn" href="#" class="btn-outline">â¬‡ Download CSV</a>
      </div>
    </div>

    <!-- Summary cards -->
    <div class="summary-row" id="summaryRow"></div>

    <!-- Warning bar -->
    <div class="warning-bar" id="warningBar" style="display:none"></div>

    <!-- Candidate list -->
    <div id="resultsList"></div>

    <!-- COMPARE PANEL -->
    <div class="compare-section" id="comparePanel">
      <div class="compare-header">
        <span class="compare-title">âš–ï¸ Candidate Comparison</span>
        <button class="compare-close" onclick="closeCompare()">âœ•</button>
      </div>
      <div class="compare-body">
        <div class="compare-select-row">
          <select class="compare-select" id="selectA"></select>
          <span style="font-family:'DM Mono',monospace;font-size:.72rem;color:var(--muted)">vs</span>
          <select class="compare-select" id="selectB"></select>
          <button class="btn-compare" onclick="runCompare()">Compare â†’</button>
        </div>
        <div id="compareResult"></div>
      </div>
    </div>
  </div>

</div>

<script>
// â”€â”€ Profile selector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let selectedProfile = 'balanced';
document.querySelectorAll('.profile-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.profile-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    selectedProfile = btn.dataset.profile;
  });
});

// â”€â”€ Dropzone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const dz = document.getElementById('dropzone');
const fileInput = document.getElementById('fileInput');
const fileList = document.getElementById('fileList');
let selectedFiles = [];

// Click anywhere on dropzone â†’ open file picker
dz.addEventListener('click', () => fileInput.click());

// Drag & drop
dz.addEventListener('dragover',  e => { e.preventDefault(); e.stopPropagation(); dz.classList.add('drag-over'); });
dz.addEventListener('dragenter', e => { e.preventDefault(); e.stopPropagation(); dz.classList.add('drag-over'); });
dz.addEventListener('dragleave', e => { e.stopPropagation(); dz.classList.remove('drag-over'); });
dz.addEventListener('drop', e => {
  e.preventDefault();
  e.stopPropagation();
  dz.classList.remove('drag-over');
  if (e.dataTransfer.files.length) addFiles(e.dataTransfer.files);
});

// File picker change
fileInput.addEventListener('change', () => {
  if (fileInput.files.length) addFiles(fileInput.files);
});

function addFiles(files) {
  for (let f of files) {
    if (!selectedFiles.find(sf => sf.name === f.name)) selectedFiles.push(f);
  }
  renderFileList();
}
function removeFile(name) {
  selectedFiles = selectedFiles.filter(f => f.name !== name);
  renderFileList();
}
function renderFileList() {
  fileList.innerHTML = selectedFiles.map(f =>
    `<span class="file-chip">ğŸ“„ ${f.name} <button onclick="removeFile('${f.name}')">Ã—</button></span>`
  ).join('');
}

// â”€â”€ Loading steps animation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const loadingSteps = [
  'Extracting text from filesâ€¦',
  'Fitting TF-IDF on all documentsâ€¦',
  'Computing cosine similaritiesâ€¦',
  'Scoring keyword overlapâ€¦',
  'Analysing skill tiersâ€¦',
  'Detecting experience & educationâ€¦',
  'Checking for keyword stuffingâ€¦',
  'Ranking candidatesâ€¦'
];
let stepInterval;
function startLoadingAnimation() {
  let i = 0;
  const el = document.getElementById('loadingStep');
  el.textContent = loadingSteps[0];
  stepInterval = setInterval(() => {
    i = (i + 1) % loadingSteps.length;
    el.textContent = loadingSteps[i];
  }, 900);
}
function stopLoadingAnimation() { clearInterval(stepInterval); }

// â”€â”€ Form submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('rankForm').addEventListener('submit', async e => {
  e.preventDefault();
  const jd = document.getElementById('jd').value.trim();
  if (!jd) { alert('Please enter a job description.'); return; }
  if (!selectedFiles.length) { alert('Please upload at least one resume.'); return; }

  const fd = new FormData();
  fd.append('job_description', jd);
  fd.append('profile', selectedProfile);
  selectedFiles.forEach(f => fd.append('resumes', f));

  document.getElementById('loading').classList.add('active');
  document.getElementById('resultsSection').classList.remove('active');
  document.getElementById('rankBtn').disabled = true;
  startLoadingAnimation();

  try {
    const res = await fetch('/rank', { method:'POST', body:fd });
    const data = await res.json();
    if (data.error) { alert(data.error); return; }
    renderResults(data);
  } catch(err) {
    alert('Network or server error. Check the console.');
    console.error(err);
  } finally {
    stopLoadingAnimation();
    document.getElementById('loading').classList.remove('active');
    document.getElementById('rankBtn').disabled = false;
  }
});

// â”€â”€ Render results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderResults(data) {
  const { results, report_id, profile, warnings } = data;
  currentResults = results;  // store for compare feature
  redFlagCache   = {};        // reset cache on new ranking

  document.getElementById('downloadBtn').href = `/download/${report_id}`;
  document.getElementById('resultsMeta').textContent =
    `${results.length} candidate${results.length !== 1 ? 's' : ''} Â· Profile: ${profile} Â· ${new Date().toLocaleTimeString()}`;

  // Show compare button if 2+ candidates
  const cmpBtn = document.getElementById('compareBtn');
  if (results.length >= 2) cmpBtn.style.display = 'flex';
  else cmpBtn.style.display = 'none';

  // Summary cards
  const topScore = results[0]?.final_score ?? 0;
  const avgScore = results.reduce((a,r) => a + r.final_score, 0) / results.length;
  const aCount = results.filter(r => ['A+','A','B'].includes(r.grade)).length;
  document.getElementById('summaryRow').innerHTML = `
    <div class="sum-card"><div class="sum-num">${results.length}</div><div class="sum-lbl">Candidates Ranked</div></div>
    <div class="sum-card"><div class="sum-num" style="color:var(--gold)">${topScore}</div><div class="sum-lbl">Top Score</div></div>
    <div class="sum-card"><div class="sum-num">${avgScore.toFixed(1)}</div><div class="sum-lbl">Average Score</div></div>
    <div class="sum-card"><div class="sum-num" style="color:var(--green)">${aCount}</div><div class="sum-lbl">Strong Matches (A/B)</div></div>
  `;

  // Warnings
  if (warnings && warnings.length) {
    document.getElementById('warningBar').style.display = 'block';
    document.getElementById('warningBar').innerHTML = 'âš  ' + warnings.join(' | ');
  }

  // Cards
  document.getElementById('resultsList').innerHTML = results.map((r, i) => buildCard(r, i)).join('');

  document.getElementById('resultsSection').classList.add('active');
  document.getElementById('resultsSection').scrollIntoView({ behavior:'smooth' });

  // Draw radar charts after DOM ready
  setTimeout(() => results.forEach((r, i) => drawRadar(`radar-${i}`, r)), 80);
}

function buildCard(r, i) {
  const gradeClass = 'g' + r.grade.replace('+','\\+');

  // Penalty/boost badges in header
  const penalties = [];
  if (r.stuffing_multiplier < 1.0)
    penalties.push(`<span style="color:var(--red);font-size:.63rem;">âš  keyword stuffing Ã—${r.stuffing_multiplier}</span>`);
  if (r.length_multiplier < 1.0)
    penalties.push(`<span style="color:var(--red);font-size:.63rem;">âš  short resume Ã—${r.length_multiplier}</span>`);
  if (r.required_boost > 1.0)
    penalties.push(`<span style="color:var(--green);font-size:.63rem;">âœ… all required skills +boost</span>`);
  if (r.required_penalty < 1.0)
    penalties.push(`<span style="color:var(--red);font-size:.63rem;">âŒ required skills gap Ã—${r.required_penalty}</span>`);

  // ATS bar colour class
  const cov = r.required_coverage ?? 100;
  const atsCls = cov >= 100 ? 'full' : cov >= 80 ? 'high' : cov >= 50 ? 'mid' : 'low';

  // Required skills split
  const reqHit  = r.required_hit  || [];
  const reqMiss = r.required_miss || [];
  const prefHit = r.preferred_hit || [];
  const hasRequired = reqHit.length + reqMiss.length > 0;

  // Explanation lines
  const explanation = r.explanation || [];

  return `
  <div class="candidate-card rank-${r.rank}" id="card-${i}">
    <div class="card-top" id="ctop-${i}" onclick="toggleCard(${i})">
      <div class="rank-badge">#${r.rank}</div>
      <div>
        <div class="cand-name">${r.filename}</div>
        <div class="cand-meta">
          ${r.years_experience > 0 ? r.years_experience + ' yrs Â· ' : ''}
          ${r.education_label ? r.education_label + ' Â· ' : ''}
          ${r.skills_found.length} skills Â· ${r.word_count} words
        </div>
        ${penalties.length ? `<div style="margin-top:4px">${penalties.join(' &nbsp; ')}</div>` : ''}
      </div>
      <div class="score-right">
        <div>
          <div class="score-num">${r.final_score}</div>
          <div class="grade-chip ${gradeClass}">${r.grade} â€” ${r.label}</div>
        </div>
        <div class="expand-btn">â–¾</div>
      </div>
    </div>

    <div class="card-details" id="details-${i}">

      <!-- ATS Required Skill Coverage Bar -->
      ${hasRequired ? `
      <div class="ats-bar-wrap">
        <div class="ats-bar-label">
          ATS Required Skill Coverage
          <span style="color:${cov>=80?'var(--green)':cov>=50?'var(--gold)':'var(--red)'}">${cov}%</span>
        </div>
        <div class="ats-track"><div class="ats-fill ${atsCls}" style="width:${cov}%"></div></div>
      </div>` : ''}

      <!-- Score breakdown bars -->
      <div class="breakdown-title" style="margin-top:18px">Score Breakdown</div>
      <div class="score-grid">
        ${barItem('TF-IDF', r.tfidf_pct, 'tfidf')}
        ${barItem('Keywords', r.keyword_pct, 'keyword')}
        ${barItem('Skills', r.skill_pct, 'skill')}
        ${barItem('Experience', r.experience_pct, 'exp')}
        ${barItem('Education', r.education_pct, 'edu')}
      </div>

      <!-- Required / Preferred / All / Missing skills -->
      ${hasRequired ? `
      <div class="skills-row" style="grid-template-columns:1fr 1fr 1fr 1fr; margin-bottom:12px;">
        <div>
          <div class="skill-group-title" style="color:#059669">âœ… Required Present (${reqHit.length})</div>
          ${reqHit.map(s=>`<span class="skill-tag tag-required-hit">${s}</span>`).join('')||'<span style="font-size:.72rem;color:var(--muted)">none</span>'}
        </div>
        <div>
          <div class="skill-group-title" style="color:var(--red)">âŒ Required Missing (${reqMiss.length})</div>
          ${reqMiss.map(s=>`<span class="skill-tag tag-required-miss">${s}</span>`).join('')||'<span style="font-size:.72rem;color:var(--green)">none!</span>'}
        </div>
        <div>
          <div class="skill-group-title" style="color:#5b21b6">â­ Preferred (${prefHit.length})</div>
          ${prefHit.map(s=>`<span class="skill-tag tag-preferred">${s}</span>`).join('')||'<span style="font-size:.72rem;color:var(--muted)">none</span>'}
        </div>
        <div>
          <div class="skill-group-title" style="color:var(--red)">âœ— All Missing (${r.skills_missing.length})</div>
          ${r.skills_missing.map(s=>`<span class="skill-tag tag-missing">${s}</span>`).join('')||'<span style="font-size:.72rem;color:var(--green)">None!</span>'}
        </div>
      </div>` : `
      <div class="skills-row">
        <div>
          <div class="skill-group-title" style="color:var(--green)">âœ“ Matched (${r.skills_matched.length})</div>
          ${r.skills_matched.map(s=>`<span class="skill-tag tag-match">${s}</span>`).join('')||'<span style="font-size:.72rem;color:var(--muted)">none</span>'}
        </div>
        <div>
          <div class="skill-group-title">All Found (${r.skills_found.length})</div>
          ${r.skills_found.map(s=>`<span class="skill-tag tag-found">${s}</span>`).join('')||'<span style="font-size:.72rem;color:var(--muted)">none</span>'}
        </div>
        <div>
          <div class="skill-group-title" style="color:var(--red)">âœ— Gaps (${r.skills_missing.length})</div>
          ${r.skills_missing.map(s=>`<span class="skill-tag tag-missing">${s}</span>`).join('')||'<span style="font-size:.72rem;color:var(--green)">No gaps!</span>'}
        </div>
      </div>`}

      <!-- EXPLAINABILITY SECTION -->
      ${explanation.length ? `
      <div class="explain-section">
        <div class="explain-title">ğŸ§  AI Explanation â€” Why this score?</div>
        ${explanation.map(line => {
          const icon = line.slice(0,2);
          const text = line.slice(2).trim();
          return `<div class="explain-line"><span class="explain-icon">${icon}</span><span class="explain-text">${escHtml(text)}</span></div>`;
        }).join('')}
      </div>` : ''}

      <div class="detail-bottom">
        <div>
          <div class="breakdown-title" style="margin-top:16px">Resume Preview</div>
          <div class="preview-box">${escHtml(r.text_preview)}</div>
        </div>
        <div class="radar-wrap">
          <div class="radar-title">Score Radar</div>
          <canvas id="radar-${i}" width="220" height="220"></canvas>
        </div>
      </div>

      <!-- RED FLAG DETECTOR -->
      <div style="margin-top:14px;display:flex;align-items:center;gap:12px">
        <button class="btn-outline" id="rf-btn-${i}"
          onclick="loadRedFlags('${r.filename.replace(/'/g,"\\'")}', ${JSON.stringify(r.text_preview + '...')}, ${i})"
          style="font-size:.68rem;padding:7px 14px;">
          ğŸš© Scan Red Flags
        </button>
        <span style="font-family:'DM Mono',monospace;font-size:.62rem;color:var(--muted)">
          Detects gaps, job hopping, vague language & more
        </span>
      </div>
      <div id="rf-result-${i}"></div>
    </div>
  </div>`;
}

function barItem(label, val, cls) {
  return `
  <div class="score-bar-item">
    <label>${label}</label>
    <div class="bar-track"><div class="bar-fill bar-${cls}" style="width:${val}%"></div></div>
    <div class="bar-val">${val} / 100</div>
  </div>`;
}

function escHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function toggleCard(i) {
  document.getElementById(`details-${i}`).classList.toggle('open');
  document.getElementById(`ctop-${i}`).classList.toggle('open');
  // Redraw radar on first open
  const canvas = document.getElementById(`radar-${i}`);
  if (canvas && canvas._data) drawRadar(`radar-${i}`, canvas._data);
}

// â”€â”€ Radar Chart (pure canvas, no library) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawRadar(canvasId, r) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  canvas._data = r;

  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  const cx = W/2, cy = H/2, maxR = Math.min(W,H)/2 - 32;

  const labels = ['TF-IDF','Keywords','Skills','Experience','Education'];
  const values = [r.tfidf_pct/100, r.keyword_pct/100, r.skill_pct/100, r.experience_pct/100, r.education_pct/100];
  const N = labels.length;

  ctx.clearRect(0, 0, W, H);

  // Grid rings
  for (let ring = 1; ring <= 4; ring++) {
    const rr = maxR * (ring/4);
    ctx.beginPath();
    for (let j=0; j<N; j++) {
      const angle = (j/N)*2*Math.PI - Math.PI/2;
      const x = cx + rr*Math.cos(angle);
      const y = cy + rr*Math.sin(angle);
      j === 0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
    }
    ctx.closePath();
    ctx.strokeStyle = 'rgba(0,0,0,0.07)';
    ctx.lineWidth = 1;
    ctx.stroke();
  }

  // Axes
  for (let j=0; j<N; j++) {
    const angle = (j/N)*2*Math.PI - Math.PI/2;
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(cx + maxR*Math.cos(angle), cy + maxR*Math.sin(angle));
    ctx.strokeStyle = 'rgba(0,0,0,0.1)';
    ctx.lineWidth = 1;
    ctx.stroke();
  }

  // Data polygon
  ctx.beginPath();
  for (let j=0; j<N; j++) {
    const angle = (j/N)*2*Math.PI - Math.PI/2;
    const r2 = maxR * values[j];
    const x = cx + r2*Math.cos(angle);
    const y = cy + r2*Math.sin(angle);
    j === 0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
  }
  ctx.closePath();
  ctx.fillStyle = 'rgba(201,168,76,0.25)';
  ctx.fill();
  ctx.strokeStyle = '#c9a84c';
  ctx.lineWidth = 2;
  ctx.stroke();

  // Dots
  for (let j=0; j<N; j++) {
    const angle = (j/N)*2*Math.PI - Math.PI/2;
    const r2 = maxR * values[j];
    ctx.beginPath();
    ctx.arc(cx + r2*Math.cos(angle), cy + r2*Math.sin(angle), 4, 0, 2*Math.PI);
    ctx.fillStyle = '#c9a84c';
    ctx.fill();
  }

  // Labels
  ctx.fillStyle = '#7a7060';
  ctx.font = '10px DM Mono, monospace';
  ctx.textAlign = 'center';
  for (let j=0; j<N; j++) {
    const angle = (j/N)*2*Math.PI - Math.PI/2;
    const lr = maxR + 20;
    const x = cx + lr*Math.cos(angle);
    const y = cy + lr*Math.sin(angle) + 4;
    ctx.fillText(labels[j], x, y);
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FEATURE 1: JD QUALITY SCORER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function analyzeJD() {
  const jd = document.getElementById('jd').value.trim();
  if (!jd) { alert('Please enter a job description first.'); return; }

  const btn = document.getElementById('analyzeJdBtn');
  btn.textContent = 'â³ Analyzingâ€¦';
  btn.disabled = true;

  try {
    const res = await fetch('/analyze_jd', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({job_description: jd})
    });
    const d = await res.json();
    if (d.error) { alert(d.error); return; }
    renderJDPanel(d);
  } catch(e) {
    alert('Error analyzing JD. Is the server running?');
  } finally {
    btn.textContent = 'ğŸ” Score JD Quality';
    btn.disabled = false;
  }
}

function renderJDPanel(d) {
  const gradeColors = {A:'#065f46',B:'#1e40af',C:'#854d0e',D:'#991b1b',F:'#6b7280'};
  const gradeBg     = {A:'#d1fae5',B:'#dbeafe',C:'#fef9c3',D:'#fee2e2',F:'#f3f4f6'};
  const dimColor = v => v >= 80 ? '#059669' : v >= 60 ? '#d97706' : '#dc2626';

  const biasHtml = d.bias_flags.length
    ? d.bias_flags.map(f => `
        <div class="bias-flag bias-${f.severity}">
          <div>
            <strong>${f.type} (${f.severity})</strong>
            Found: ${f.matches.map(m=>`<code>${m}</code>`).join(', ')}<br>
            <span style="color:#6b7280">${f.suggestion}</span>
          </div>
        </div>`).join('')
    : '<div style="color:#059669;font-size:.8rem">âœ… No bias patterns detected</div>';

  const suggestHtml = d.suggestions.length
    ? d.suggestions.map(s=>`<div class="jd-suggest-item">${s}</div>`).join('')
    : '<div class="jd-suggest-item" style="color:#059669">âœ… JD looks well-structured!</div>';

  const dims = d.dimensions;
  const panel = document.getElementById('jdScorePanel');
  panel.innerHTML = `
    <div class="jd-panel-header">
      <span class="jd-panel-title">ğŸ” JD Quality Analysis</span>
      <div class="jd-overall-badge">
        <span>${d.overall_score}</span>
        <span class="jd-grade-chip" style="background:${gradeBg[d.grade]};color:${gradeColors[d.grade]}">${d.grade} â€” ${d.verdict}</span>
      </div>
    </div>
    <div class="jd-body">
      <div class="jd-dim-grid">
        ${[['Completeness',dims.completeness],['Clarity',dims.clarity],['Skill Specificity',dims.skill_specificity],['Bias-Free',dims.bias_free]].map(([lbl,val])=>`
          <div class="jd-dim-item">
            <div class="jd-dim-val" style="color:${dimColor(val)}">${val}</div>
            <div class="jd-dim-lbl">${lbl}</div>
            <div class="jd-dim-bar" style="background:${dimColor(val)};width:${val}%;max-width:100%"></div>
          </div>`).join('')}
      </div>
      <div class="jd-verdict">${d.verdict}</div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
        <div>
          <div class="breakdown-title" style="margin-bottom:10px">âš ï¸ Bias & Language Flags</div>
          <div class="jd-bias-list">${biasHtml}</div>
        </div>
        <div>
          <div class="breakdown-title" style="margin-bottom:10px">ğŸ’¡ Improvement Suggestions</div>
          <div class="jd-suggestions">${suggestHtml}</div>
          <div style="margin-top:12px;font-family:'DM Mono',monospace;font-size:.62rem;color:var(--muted)">
            ${d.stats.word_count} words Â· ${d.stats.skill_count} skills Â· ${d.stats.sections_found.length} sections found
          </div>
        </div>
      </div>
    </div>`;
  panel.classList.add('active');
  panel.scrollIntoView({behavior:'smooth'});
}


// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FEATURE 2: RED FLAG DETECTOR (called per card, stored in results)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let redFlagCache = {};  // filename â†’ result

async function loadRedFlags(filename, resumeText, cardIndex) {
  if (redFlagCache[filename]) {
    renderRedFlags(redFlagCache[filename], cardIndex);
    return;
  }
  const btn = document.getElementById(`rf-btn-${cardIndex}`);
  if (btn) { btn.textContent = 'â³ Scanningâ€¦'; btn.disabled = true; }

  try {
    const res = await fetch('/red_flags', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({resume_text: resumeText, filename})
    });
    const d = await res.json();
    redFlagCache[filename] = d;
    renderRedFlags(d, cardIndex);
  } catch(e) {
    const el = document.getElementById(`rf-result-${cardIndex}`);
    if (el) el.innerHTML = '<span style="color:var(--red);font-size:.78rem">Error scanning resume</span>';
  } finally {
    if (btn) { btn.textContent = 'ğŸš© Scan Red Flags'; btn.disabled = false; }
  }
}

function renderRedFlags(d, cardIndex) {
  const el = document.getElementById(`rf-result-${cardIndex}`);
  if (!el) return;

  const riskColors = {Low:'#065f46', Medium:'#92400e', High:'#991b1b'};
  const sevColor   = s => s==='high'?'var(--red)':s==='medium'?'#d97706':'#059669';

  const flagsHtml = d.flags.length
    ? d.flags.map(f=>`
        <div class="flag-item">
          <span class="flag-icon">${f.icon}</span>
          <div class="flag-body">
            <strong style="color:${sevColor(f.severity)}">${f.type} â€” ${f.message}</strong>
            <span>${f.detail}</span>
          </div>
        </div>`).join('')
    : '<div style="color:#059669;font-size:.8rem;padding:6px 0">âœ… No red flags detected</div>';

  const greenHtml = d.green_flags.length
    ? `<div class="breakdown-title" style="margin-top:12px;margin-bottom:8px">ğŸŒŸ Green Flags (${d.green_flags.length})</div>
       <div class="green-flag-list">${d.green_flags.map(g=>`<span class="green-tag">âœ“ ${g}</span>`).join('')}</div>`
    : '';

  el.innerHTML = `
    <div class="redflag-section">
      <div class="redflag-header">
        <div class="breakdown-title" style="margin-bottom:0">ğŸš© Red Flag Analysis</div>
        <span class="risk-badge risk-${d.risk_level}">${d.risk_level} Risk â€” Score ${d.risk_score}/100</span>
      </div>
      <div style="font-size:.78rem;color:var(--muted);margin-bottom:10px;font-style:italic">${d.summary}</div>
      ${flagsHtml}
      ${greenHtml}
    </div>`;
}


// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FEATURE 3: CANDIDATE COMPARISON
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentResults = [];

function openCompare() {
  const panel = document.getElementById('comparePanel');
  panel.classList.add('active');
  panel.scrollIntoView({behavior:'smooth'});

  // Populate selects
  const selA = document.getElementById('selectA');
  const selB = document.getElementById('selectB');
  selA.innerHTML = currentResults.map((r,i)=>`<option value="${i}">${r.filename} (${r.final_score})</option>`).join('');
  selB.innerHTML = currentResults.map((r,i)=>`<option value="${i}">${r.filename} (${r.final_score})</option>`).join('');
  if (currentResults.length >= 2) selB.value = '1';
}

function closeCompare() {
  document.getElementById('comparePanel').classList.remove('active');
}

async function runCompare() {
  const idxA = parseInt(document.getElementById('selectA').value);
  const idxB = parseInt(document.getElementById('selectB').value);
  if (idxA === idxB) { alert('Please select two different candidates.'); return; }

  try {
    const res = await fetch('/compare', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({results: currentResults, idx_a: idxA, idx_b: idxB})
    });
    const d = await res.json();
    if (d.error) { alert(d.error); return; }
    renderCompare(d);
  } catch(e) {
    alert('Comparison error. Is the server running?');
  }
}

function renderCompare(d) {
  const a = d.candidate_a, b = d.candidate_b;
  const scoreColor = (va, vb) => va > vb ? 'winner-a' : va < vb ? 'winner-b' : '';

  const signalRows = d.breakdown.map(s => {
    const maxVal = Math.max(s.a_val, s.b_val, 1);
    const wA = Math.round((s.a_val / 100) * 120);
    const wB = Math.round((s.b_val / 100) * 120);
    return `
      <div class="signal-row">
        <div class="signal-bar-left">
          <span class="signal-val ${s.winner==='a'?'winner-a':''}">${s.a_val}</span>
          <div class="sig-bar sig-bar-a" style="width:${wA}px"></div>
        </div>
        <div class="signal-name">${s.signal}</div>
        <div class="signal-bar-right">
          <div class="sig-bar sig-bar-b" style="width:${wB}px"></div>
          <span class="signal-val ${s.winner==='b'?'winner-b':''}">${s.b_val}</span>
        </div>
      </div>`;}).join('');

  const skillCol = (title, skills, color) => `
    <div>
      <div class="compare-skill-title" style="color:${color}">${title}</div>
      ${skills.length
        ? skills.map(s=>`<span class="skill-tag tag-found" style="margin:2px;display:inline-block">${s}</span>`).join('')
        : '<span style="font-size:.72rem;color:var(--muted)">none</span>'}
    </div>`;

  document.getElementById('compareResult').innerHTML = `
    <div class="compare-grid">
      <div class="compare-col">
        <div class="compare-col-header">
          <div class="compare-col-name">${a.filename}</div>
          <div class="compare-col-score" style="color:var(--gold)">${a.final_score}</div>
          <div class="compare-col-grade">${a.grade} Â· ${a.years_experience}yr Â· ${a.education_label}</div>
        </div>
      </div>
      <div class="compare-vs"><div class="vs-label">VS</div></div>
      <div class="compare-col">
        <div class="compare-col-header">
          <div class="compare-col-name">${b.filename}</div>
          <div class="compare-col-score" style="color:#6366f1">${b.final_score}</div>
          <div class="compare-col-grade">${b.grade} Â· ${b.years_experience}yr Â· ${b.education_label}</div>
        </div>
      </div>
    </div>

    <div style="margin-bottom:20px">${signalRows}</div>

    <div class="compare-skills">
      ${skillCol(`Only in ${a.filename}`, d.unique_to_a, 'var(--gold)')}
      ${skillCol('Common Skills', d.common_skills, 'var(--green)')}
      ${skillCol(`Only in ${b.filename}`, d.unique_to_b, '#6366f1')}
    </div>

    <div class="compare-recommendation">
      ğŸ¯ <strong>Recommendation:</strong> ${d.recommendation}
    </div>`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UPDATED renderResults â€” wire up new features
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Store raw text per candidate for red flag scanning
let resumeTextCache = {};  // filename â†’ raw text
</script>
</body>
</html>